name: Test X API Connection

on:
  workflow_dispatch:

jobs:
  test_tweet:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install tweepy
        run: pip install tweepy

      - name: Send Test Tweet
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_KEY_SECRET: ${{ secrets.X_API_KEY_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}
        run: |
          cat << 'EOF' > test_tweet.py
import os, sys, tweepy

api_key = os.environ.get('X_API_KEY')
api_secret = os.environ.get('X_API_KEY_SECRET')
access_token = os.environ.get('X_ACCESS_TOKEN')
access_secret = os.environ.get('X_ACCESS_TOKEN_SECRET')

if not all([api_key, api_secret, access_token, access_secret]):
    print("Error: Missing one or more Twitter API credentials in GitHub Secrets.")
    sys.exit(1)

try:
    client = tweepy.Client(
        consumer_key=api_key,
        consumer_secret=api_secret,
        access_token=access_token,
        access_token_secret=access_secret
    )
    
    response = client.create_tweet(text="Testing the X API connection for The Scoop Kenya via GitHub Actions! ðŸš€")
    print(f"Success! Test tweet sent. Tweet ID: {response.data['id']}")
    
except Exception as e:
    print(f"Twitter API Error: {e}")
    sys.exit(1)
EOF
          python3 test_tweet.py