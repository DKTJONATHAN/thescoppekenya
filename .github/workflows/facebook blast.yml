name: Test Facebook Posting

on:
  workflow_dispatch:

jobs:
  test-fb-post:
    runs-on: ubuntu-latest
    steps:
      - name: Send test message to Facebook
        env:
          FACEBOOK_PAGE_ID: ${{ secrets.FACEBOOK_PAGE_ID }}
          FACEBOOK_PAGE_TOKEN: ${{ secrets.FACEBOOK_PAGE_TOKEN }}
        run: |
          if [ -z "$FACEBOOK_PAGE_ID" ] || [ -z "$FACEBOOK_PAGE_TOKEN" ]; then
            echo "‚ö†Ô∏è Facebook credentials not set, exiting."
            exit 1
          fi

          echo "üöÄ Sending test message to Facebook..."
          
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST \
            "https://graph.facebook.com/v24.0/${FACEBOOK_PAGE_ID}/feed" \
            -d "message=welcome back" \
            -d "access_token=${FACEBOOK_PAGE_TOKEN}")

          HTTP_CODE=$(echo "$RESPONSE" | tail -1)
          BODY=$(echo "$RESPONSE" | head -n -1)

          if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 300 ]; then
            echo "‚úÖ Test post successful (${HTTP_CODE})"
            echo "Response: ${BODY}"
          else
            echo "‚ùå Test post failed (${HTTP_CODE}): ${BODY}"
            exit 1
          fi